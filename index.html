<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hotspot Keep-Alive</title>
    
    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Hotspot">
    <link rel="apple-touch-icon" href="https://www.google.com/favicon.ico">

    <style>
        :root {
            --bg: #000000;
            --accent: #0A84FF;
            --danger: #FF453A;
            --surface: #1C1C1E;
            --text: #ffffff;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-user-select: none;
        }

        .safe-top { height: env(safe-area-inset-top); }
        .safe-bottom { height: env(safe-area-inset-bottom); }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            padding: 20px;
        }

        .status-box {
            text-align: center;
            background: var(--surface);
            padding: 15px 30px;
            border-radius: 50px;
            border: 1px solid #333;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .status-box.active {
            border-color: var(--accent);
            color: var(--accent);
            box-shadow: 0 0 20px rgba(10, 132, 255, 0.2);
        }

        .main-btn {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: none;
            background: var(--accent);
            color: white;
            font-size: 24px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 0 40px rgba(10, 132, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .main-btn.active {
            background: var(--danger);
            box-shadow: 0 0 40px rgba(255, 69, 58, 0.3);
            transform: scale(0.95);
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            max-width: 350px;
        }

        .stat-item {
            background: var(--surface);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
        }

        .stat-val {
            display: block;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-lbl {
            font-size: 11px;
            color: #8E8E93;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .logs {
            width: 100%;
            height: 100px;
            background: #000;
            border-top: 1px solid #222;
            padding: 10px;
            font-family: monospace;
            font-size: 10px;
            color: #444;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse;
        }

        #pwa-setup {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
        }

        .log-entry { margin-bottom: 2px; }
        .log-entry.blue { color: var(--accent); }
    </style>
</head>
<body>

    <div id="pwa-setup">
        <h2 style="color: var(--accent)">KURULUM GEREKLİ</h2>
        <p>Hotspot korumasının arka planda çalışabilmesi için uygulamayı ana ekrana eklemelisiniz.</p>
        <div style="font-size: 40px; margin: 20px 0;">⬇️</div>
        <p style="font-size: 13px; color: #666;">Paylaş butonuna dokunun ve "Ana Ekrana Ekle"yi seçin.</p>
    </div>

    <div class="safe-top"></div>

    <div class="container">
        <div id="statusIndicator" class="status-box">
            SİSTEM: <span id="statusLabel">DURDURULDU</span>
        </div>

        <button id="ctrlBtn" class="main-btn">BAŞLAT</button>

        <div class="stats">
            <div class="stat-item">
                <span id="pingCount" class="stat-val">0</span>
                <span class="stat-lbl">PİNG</span>
            </div>
            <div class="stat-item">
                <span id="uptime" class="stat-val">00:00</span>
                <span class="stat-lbl">SÜRE</span>
            </div>
        </div>

        <p style="font-size: 11px; color: #444; text-align: center; padding: 0 20px;">
            Başlattıktan sonra cihazınızı kilitleyebilirsiniz. 1Hz sessiz sinyal sistemin uyumasını engelleyecektir.
        </p>
    </div>

    <div id="logArea" class="logs"></div>
    <div class="safe-bottom"></div>

    <script>
        let running = false;
        let pings = 0;
        let startTime = null;
        let audioCtx = null;
        let oscillator = null;
        let timerId = null;
        let uptimeId = null;

        const ctrlBtn = document.getElementById('ctrlBtn');
        const statusLabel = document.getElementById('statusLabel');
        const statusIndicator = document.getElementById('statusIndicator');
        const pingCountEl = document.getElementById('pingCount');
        const uptimeEl = document.getElementById('uptime');
        const logArea = document.getElementById('logArea');

        // PWA Check
        if (!window.navigator.standalone && /iPhone|iPad|iPod/.test(navigator.userAgent)) {
            document.getElementById('pwa-setup').style.display = 'flex';
        }

        function addLog(msg, isBlue = false) {
            const div = document.createElement('div');
            div.className = `log-entry ${isBlue ? 'blue' : ''}`;
            div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logArea.prepend(div);
            if (logArea.children.length > 30) logArea.lastChild.remove();
        }

        function updateUptime() {
            if (!startTime) return;
            const diff = Math.floor((Date.now() - startTime) / 1000);
            const m = Math.floor(diff / 60).toString().padStart(2, '0');
            const s = (diff % 60).toString().padStart(2, '0');
            uptimeEl.innerText = `${m}:${s}`;
        }

        async function ping() {
            if (!running) return;
            try {
                // Hotspot uyanık tutma trafiği
                await fetch('https://www.google.com/generate_204', { mode: 'no-cors', cache: 'no-store' });
                pings++;
                pingCountEl.innerText = pings;
                if (pings % 10 === 0) addLog("Bağlantı aktif tutuluyor.");
            } catch (e) {
                addLog("Ping hatası", true);
            }
        }

        function startKeepAlive() {
            try {
                // 1. Web Audio Sinyali (1Hz subsonic)
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                oscillator = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(1, audioCtx.currentTime); // 1 Hz (Duyulmaz)
                
                gain.gain.setValueAtTime(0.001, audioCtx.currentTime); // Çok düşük ses
                
                oscillator.connect(gain);
                gain.connect(audioCtx.destination);
                oscillator.start();

                // 2. Media Session API (iOS Arka Plan Kilidi)
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: 'Hotspot Koruyucu',
                        artist: 'Keep-Alive Aktif',
                        album: 'Arka Plan Modu'
                    });
                    // iOS için boş handlerlar
                    navigator.mediaSession.setActionHandler('play', () => {});
                    navigator.mediaSession.setActionHandler('pause', () => {});
                }

                // 3. Döngüler
                running = true;
                startTime = Date.now();
                timerId = setInterval(ping, 5000);
                uptimeId = setInterval(updateUptime, 1000);

                // UI
                ctrlBtn.innerText = "DURDUR";
                ctrlBtn.classList.add('active');
                statusIndicator.classList.add('active');
                statusLabel.innerText = "AKTİF";
                addLog("1Hz Sinyal Başlatıldı.", true);
                addLog("Arka plan kilidi devrede.");

            } catch (err) {
                addLog("Başlatma hatası: " + err.message);
            }
        }

        function stopKeepAlive() {
            running = false;
            if (oscillator) oscillator.stop();
            if (audioCtx) audioCtx.close();
            if (timerId) clearInterval(timerId);
            if (uptimeId) clearInterval(uptimeId);
            
            startTime = null;
            ctrlBtn.innerText = "BAŞLAT";
            ctrlBtn.classList.remove('active');
            statusIndicator.classList.remove('active');
            statusLabel.innerText = "DURDURULDU";
            addLog("Sistem kapatıldı.");
        }

        ctrlBtn.addEventListener('click', () => {
            if (!running) startKeepAlive();
            else stopKeepAlive();
        });

        // Manifest Injection
        const manifest = {
            name: "Hotspot Keep-Alive",
            short_name: "Hotspot",
            display: "standalone",
            start_url: ".",
            background_color: "#000000",
            theme_color: "#000000"
        };
        const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = URL.createObjectURL(blob);
        document.head.appendChild(link);
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HS Nav Anchor</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Hotspot">
    <link rel="apple-touch-icon" href="https://www.google.com/favicon.ico">
    
    <style>
        :root {
            --bg: #000;
            --accent: #007AFF;
            --success: #34C759;
            --danger: #FF3B30;
            --card: #1C1C1E;
        }

        body {
            background: var(--bg);
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-user-select: none;
        }

        .safe-area-top { height: env(safe-area-inset-top); }
        .safe-area-bottom { height: env(safe-area-inset-bottom); }

        .app-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            gap: 40px;
        }

        .nav-orb {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0,122,255,0.2) 0%, rgba(0,0,0,0) 70%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .nav-orb::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid var(--accent);
            border-radius: 50%;
            opacity: 0.3;
        }

        .active .nav-orb::before {
            animation: pulse 2s infinite ease-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.8); opacity: 0; }
        }

        .main-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            background: var(--accent);
            color: white;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(0,122,255,0.4);
            z-index: 2;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .main-button:active { transform: scale(0.9); }
        .main-button.active { background: var(--danger); box-shadow: 0 0 20px rgba(255,59,48,0.4); }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            max-width: 340px;
        }

        .stat-box {
            background: var(--card);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
        }

        .stat-value {
            display: block;
            font-size: 24px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: #8E8E93;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .system-logs {
            height: 120px;
            width: 100%;
            background: #000;
            border-top: 1px solid #333;
            padding: 15px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            font-size: 10px;
            overflow-y: auto;
            color: #666;
            display: flex;
            flex-direction: column-reverse;
        }

        .log-entry { margin-bottom: 3px; }
        .log-entry.blue { color: var(--accent); }
        .log-entry.green { color: var(--success); }

        #pwa-shield {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 30px;
        }
    </style>
</head>
<body>

    <div id="pwa-shield">
        <h1 style="color: var(--accent)">NAVİGASYON MODU</h1>
        <p>iOS kısıtlamalarını aşmak için bu uygulamayı "Ana Ekrana Ekle" yapmanız ZORUNLUDUR.</p>
        <div style="font-size: 40px; margin: 20px 0;">⬆️</div>
        <p style="color: #666; font-size: 14px;">Safari alt menüsündeki "Paylaş" butonuna basın ve "Ana Ekrana Ekle"yi seçin.</p>
    </div>

    <div class="safe-area-top"></div>

    <div class="app-content" id="appBody">
        <div class="nav-orb">
            <button id="ctrlBtn" class="main-button">BAŞLAT</button>
        </div>

        <div class="dashboard">
            <div class="stat-box">
                <span id="coordVal" class="stat-value">---</span>
                <span class="stat-label">KONUM KİLİDİ</span>
            </div>
            <div class="stat-box">
                <span id="pingVal" class="stat-value">0</span>
                <span class="stat-label">AĞ TRAFİĞİ</span>
            </div>
        </div>

        <div style="text-align: center; color: #8E8E93; font-size: 12px; padding: 0 40px;">
            Mavi çubuğu aktifleştirmek için başlattıktan sonra ana ekrana dönün.
        </div>
    </div>

    <div id="logs" class="system-logs"></div>
    
    <div class="safe-area-bottom"></div>

    <script>
        let isRunning = false;
        let pings = 0;
        let watchId = null;
        let audioCtx = null;
        let beaconTimer = null;

        const ctrlBtn = document.getElementById('ctrlBtn');
        const appBody = document.getElementById('appBody');
        const logsEl = document.getElementById('logs');
        const pingVal = document.getElementById('pingVal');
        const coordVal = document.getElementById('coordVal');

        // PWA Kontrolü
        if (!window.navigator.standalone && /iPhone|iPad|iPod/.test(navigator.userAgent)) {
            document.getElementById('pwa-shield').style.display = 'flex';
        }

        function writeLog(msg, color = '') {
            const div = document.createElement('div');
            div.className = `log-entry ${color}`;
            div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logsEl.prepend(div);
            if(logsEl.children.length > 20) logsEl.lastChild.remove();
        }

        // Kesintisiz Sessizlik Üretici (Web Audio API)
        function startSilentEngine() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            // 2 saniyelik boş bir buffer oluştur
            const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 2, audioCtx.sampleRate);
            const source = audioCtx.createBufferSource();
            source.buffer = buffer;
            source.loop = true;
            
            // GainNode ile sesi tamamen kapat (sistemsel olarak hala "çalıyor" görünür)
            const gainNode = audioCtx.createGain();
            gainNode.gain.value = 0.001; 
            
            source.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            source.start();
            writeLog("Ses motoru uyanık.", "blue");
        }

        async function networkBeacon() {
            if (!isRunning) return;
            try {
                // Hotspot donanımını tetiklemek için ufak veri paketi
                await fetch('https://www.google.com/generate_204', { mode: 'no-cors', cache: 'no-store' });
                pings++;
                pingVal.innerText = pings;

                // Navigasyon uygulaması taklidi: Sürekli yeni konum isteği
                navigator.geolocation.getCurrentPosition((p) => {
                    coordVal.innerText = p.coords.latitude.toFixed(3);
                    if(pings % 5 === 0) writeLog("Nav-Link: Aktif", "green");
                }, null, { enableHighAccuracy: true });

            } catch(e) {}
            beaconTimer = setTimeout(networkBeacon, 3000);
        }

        async function startNavigationMode() {
            // 1. Ses Motorunu Başlat (User Gesture içinde olmalı)
            startSilentEngine();

            // 2. Agresif Konum Takibini Başlat (Mavi Çubuk Tetikleyicisi)
            watchId = navigator.geolocation.watchPosition(
                (p) => { /* Aktif izleme */ },
                (e) => { writeLog("GPS Hatası: " + e.code, "red"); },
                { 
                    enableHighAccuracy: true, 
                    maximumAge: 0, 
                    timeout: 27000 
                }
            );

            // 3. Döngüyü Başlat
            isRunning = true;
            networkBeacon();

            // UI Güncelle
            ctrlBtn.innerText = "DURDUR";
            ctrlBtn.classList.add('active');
            appBody.classList.add('active');
            writeLog("Navigasyon Çapası Atıldı.", "green");
        }

        function stopNavigationMode() {
            isRunning = false;
            if(watchId) navigator.geolocation.clearWatch(watchId);
            if(audioCtx) audioCtx.close();
            if(beaconTimer) clearTimeout(beaconTimer);

            ctrlBtn.innerText = "BAŞLAT";
            ctrlBtn.classList.remove('active');
            appBody.classList.remove('active');
            coordVal.innerText = "---";
            writeLog("Sistem kapatıldı.");
        }

        ctrlBtn.addEventListener('click', () => {
            if(!isRunning) startNavigationMode();
            else stopNavigationMode();
        });

        // Manifest Injection
        const manifest = {
            name: "Hotspot Nav Anchor",
            short_name: "Hotspot",
            start_url: ".",
            display: "standalone",
            background_color: "#000000",
            theme_color: "#000000"
        };
        const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = URL.createObjectURL(blob);
        document.head.appendChild(link);
    </script>
</body>
</html>